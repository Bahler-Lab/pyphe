#!/usr/bin/env python
import argparse
from pyphe.interpret import interpret 

if __name__ == '__main__':
    ###Set up parsing of command line arguments with argparse###
    parser = argparse.ArgumentParser(description='Welcome to pyphe-interpret, part of the pyphe toolbox. Written by stephan.kamrad@crick.ac.uk and maintained at https://github.com/Bahler-Lab/pyphe')
  
   
    parser.add_argument('--ld', type=str, required=True, help="Path to the Data Report Table produced by pyphe-analyse.")
    parser.add_argument('--out', type=str, required=True, default='pyphe-quantify-report', help='Specifies the path where to save the output data result. By default, a table with all replicates will be saved as pyphe-quantify-report_reps.csv and the statistic table will be saved as pyphe-quantify-report_summaryStats.csv in the current working directory. Existing files will be overwritten.')
    parser.add_argument('--condition_column', type=str, required=True, help='Name of the condition column in the data report. Data will be grouped by the strain_column and differences between all unique conditions in the condition_column and the control_condition will be tested for.')
    parser.add_argument('--strain_column', type=str, required=True, help='Name of the strain column in the data report. Data will be grouped by the strain_column and differences between all unique conditions in the condition_column and the control_condition will be tested for.')
    parser.add_argument('--values_column', type=str, default='Colony_size_corr_checked', help='Name of the column in the data report to use as fitness values. Defaults to "Colony_size_corr_checked".')
    parser.add_argument('--control_condition', type=str, required=True, help='Name of the control condition. Effect sizes and and p-values will conpare each condition agaisnt the control condition.')
    parser.add_argument('--ld_encoding', default='utf-8', type=str, help='Encoding of the data report table to be passed to pandas.read_csv().')

    args = parser.parse_args()

    #Run analysis
    print('Interpretation is starting, with following parameters:')
    for k, v in vars(args).items():
        print('%s: %s'%(k, str(v)))

    interpret(args.ld, args.condition_column, args.strain_column, args.values_column, args.control_condition, args.out, ld_encoding=args.ld_encoding)
